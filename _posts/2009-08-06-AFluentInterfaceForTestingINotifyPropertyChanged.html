---
layout: post
tags: [Unit Testing]
date: 2009-08-06 17:58:36 UTC
title: "A Fluent Interface For Testing INotifyPropertyChanged"
---
{% include JB/setup %}

<div id="post">
	<p>If you are doing Rich UI, <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged.aspx">INotifyPropertyChanged</a> is a pretty important interface. This is as true for WPF as it was for Windows Forms. Consisting solely of an event, it's <a href="http://blogs.msdn.com/ploeh/archive/2006/01/19/TestingEventsUsingAnonymousMethods.aspx">not any harder to unit test than other events</a>.</p> <p>You can certainly write each test manually like the following.</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue0;\red255\green255\blue255;\red43\green145\blue175;\red0\green0\blue255;\red0\green128\blue0;\red163\green21\blue21;}??\fs20 [\cf3 TestMethod\cf0 ]\par ??\cf4 public\cf0  \cf4 void\cf0  ChangingMyPropertyWillRaiseNotifyEvent_Classic()\par ??\{\par ??    \cf5 // Fixture setup\par ??\cf0     \cf4 bool\cf0  eventWasRaised = \cf4 false\cf0 ;\par ??    \cf4 var\cf0  sut = \cf4 new\cf0  \cf3 MyClass\cf0 ();\par ??    sut.PropertyChanged += (sender, e) =&gt;\par ??        \{\par ??            \cf4 if\cf0  (e.PropertyName == \cf6 "MyProperty"\cf0 )\par ??            \{\par ??                eventWasRaised = \cf4 true\cf0 ;\par ??            \}\par ??        \};\par ??    \cf5 // Exercise system\par ??\cf0     sut.MyProperty = \cf6 "Some new value"\cf0 ;\par ??    \cf5 // Verify outcome\par ??\cf0     \cf3 Assert\cf0 .IsTrue(eventWasRaised, \cf6 "Event was raised"\cf0 );\par ??    \cf5 // Teardown\par ??\cf0 \}}
--> <div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px">[<span style="color: #2b91af">TestMethod</span>]</pre><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">void</span> ChangingMyPropertyWillRaiseNotifyEvent_Classic()</pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Fixture setup</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">bool</span> eventWasRaised = <span style="color: blue">false</span>;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> sut = <span style="color: blue">new</span> <span style="color: #2b91af">MyClass</span>();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; sut.PropertyChanged += (sender, e) =&gt;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (e.PropertyName == <span style="color: #a31515">"MyProperty"</span>)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eventWasRaised = <span style="color: blue">true</span>;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Exercise system</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; sut.MyProperty = <span style="color: #a31515">"Some new value"</span>;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Verify outcome</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">Assert</span>.IsTrue(eventWasRaised, <span style="color: #a31515">"Event was raised"</span>);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Teardown</span></pre><pre style="margin: 0px">}</pre></div>
<p>Even for a one-off test, this one has a few problems. From an <a href="http://xunitpatterns.com/"><em>xUnit Test Patterns</em></a> point of view, there's the issue that the test contains conditional logic, but that aside, the main problem is that if you have a lot of properties, writing all these very similar tests become old hat very soon.</p>
<p>To make testing INotifyPropertyChanged events easier, I created a simple fluent interface that allows me to write the same test like this:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue0;\red255\green255\blue255;\red43\green145\blue175;\red0\green0\blue255;\red0\green128\blue0;\red163\green21\blue21;}??\fs20 [\cf3 TestMethod\cf0 ]\par ??\cf4 public\cf0  \cf4 void\cf0  ChangingMyPropertyWillRaiseNotifyEvent_Fluent()\par ??\{\par ??    \cf5 // Fixture setup\par ??\cf0     \cf4 var\cf0  sut = \cf4 new\cf0  \cf3 MyClass\cf0 ();\par ??    \cf5 // Exercise system and verify outcome\par ??\cf0     sut.ShouldNotifyOn(s =&gt; s.MyProperty)\par ??        .When(s =&gt; s.MyProperty = \cf6 "Some new value"\cf0 );\par ??    \cf5 // Teardown\par ??\cf0 \}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px">[<span style="color: #2b91af">TestMethod</span>]</pre><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">void</span> ChangingMyPropertyWillRaiseNotifyEvent_Fluent()</pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Fixture setup</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> sut = <span style="color: blue">new</span> <span style="color: #2b91af">MyClass</span>();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Exercise system and verify outcome</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; sut.ShouldNotifyOn(s =&gt; s.MyProperty)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .When(s =&gt; s.MyProperty = <span style="color: #a31515">"Some new value"</span>);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Teardown</span></pre><pre style="margin: 0px">}</pre></div>
<p>You simply state for which property you want to verify the event when a certain operation is invoked. This is certainly more concise and intention-revealing than the previous test.</p>
<p>If you have interdependent properties, you can specify than an event was raised when another property was modified.</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue0;\red255\green255\blue255;\red43\green145\blue175;\red0\green0\blue255;\red0\green128\blue0;\red163\green21\blue21;}??\fs20 [\cf3 TestMethod\cf0 ]\par ??\cf4 public\cf0  \cf4 void\cf0  ChangingMyPropertyWillRaiseNotifyForDerived()\par ??\{\par ??    \cf5 // Fixture setup\par ??\cf0     \cf4 var\cf0  sut = \cf4 new\cf0  \cf3 MyClass\cf0 ();\par ??    \cf5 // Exercise system and verify outcome\par ??\cf0     sut.ShouldNotifyOn(s =&gt; s.MyDerivedProperty)\par ??        .When(s =&gt; s.MyProperty = \cf6 "Some new value"\cf0 );\par ??    \cf5 // Teardown\par ??\cf0 \}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px">[<span style="color: #2b91af">TestMethod</span>]</pre><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">void</span> ChangingMyPropertyWillRaiseNotifyForDerived()</pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Fixture setup</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> sut = <span style="color: blue">new</span> <span style="color: #2b91af">MyClass</span>();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Exercise system and verify outcome</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; sut.ShouldNotifyOn(s =&gt; s.MyDerivedProperty)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .When(s =&gt; s.MyProperty = <span style="color: #a31515">"Some new value"</span>);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Teardown</span></pre><pre style="margin: 0px">}</pre></div>
<p>The When method takes any Action&lt;T&gt;, so you can also invoke methods, use Closures and what not.</p>
<p>There's also a <em>ShouldNotNotifyOn</em> method to verify that an event was <em>not</em> raised when a particular operation was invoked.</p>
<p>This fluent interface is implemented with an extension method on INotifyPropertyChanged, combined with a custom class that performs the verification. Here are the extension methods:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;}??\fs20 \cf1 public\cf0  \cf1 static\cf0  \cf1 class\cf0  \cf4 NotifyPropertyChanged\par ??\cf0 \{\par ??    \cf1 public\cf0  \cf1 static\cf0  \cf4 NotifyExpectation\cf0 &lt;T&gt;\par ??        ShouldNotifyOn&lt;T, TProperty&gt;(\cf1 this\cf0  T owner,\par ??        \cf4 Expression\cf0 &lt;\cf4 Func\cf0 &lt;T, TProperty&gt;&gt; propertyPicker) \par ??        \cf1 where\cf0  T : \cf4 INotifyPropertyChanged\par ??\cf0     \{\par ??        \cf1 return\cf0  \cf4 NotifyPropertyChanged\cf0 .CreateExpectation(owner,\par ??            propertyPicker, \cf1 true\cf0 );\par ??    \}\par ??\par ??    \cf1 public\cf0  \cf1 static\cf0  \cf4 NotifyExpectation\cf0 &lt;T&gt; \par ??        ShouldNotNotifyOn&lt;T, TProperty&gt;(\cf1 this\cf0  T owner,\par ??        \cf4 Expression\cf0 &lt;\cf4 Func\cf0 &lt;T, TProperty&gt;&gt; propertyPicker)\par ??        \cf1 where\cf0  T : \cf4 INotifyPropertyChanged\par ??\cf0     \{\par ??        \cf1 return\cf0  \cf4 NotifyPropertyChanged\cf0 .CreateExpectation(owner,\par ??            propertyPicker, \cf1 false\cf0 );\par ??    \}\par ??\par ??    \cf1 private\cf0  \cf1 static\cf0  \cf4 NotifyExpectation\cf0 &lt;T&gt;\par ??        CreateExpectation&lt;T, TProperty&gt;(T owner,\par ??        \cf4 Expression\cf0 &lt;\cf4 Func\cf0 &lt;T, TProperty&gt;&gt; pickProperty,\par ??        \cf1 bool\cf0  eventExpected) \cf1 where\cf0  T : \cf4 INotifyPropertyChanged\par ??\cf0     \{\par ??        \cf1 string\cf0  propertyName =\par ??            ((\cf4 MemberExpression\cf0 )pickProperty.Body).Member.Name;\par ??        \cf1 return\cf0  \cf1 new\cf0  \cf4 NotifyExpectation\cf0 &lt;T&gt;(owner,\par ??            propertyName, eventExpected);\par ??    \}\par ??\}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">class</span> <span style="color: #2b91af">NotifyPropertyChanged</span></pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">NotifyExpectation</span>&lt;T&gt;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ShouldNotifyOn&lt;T, TProperty&gt;(<span style="color: blue">this</span> T owner,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">Expression</span>&lt;<span style="color: #2b91af">Func</span>&lt;T, TProperty&gt;&gt; propertyPicker) </pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">where</span> T : <span style="color: #2b91af">INotifyPropertyChanged</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: #2b91af">NotifyPropertyChanged</span>.CreateExpectation(owner,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyPicker, <span style="color: blue">true</span>);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">NotifyExpectation</span>&lt;T&gt; </pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ShouldNotNotifyOn&lt;T, TProperty&gt;(<span style="color: blue">this</span> T owner,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">Expression</span>&lt;<span style="color: #2b91af">Func</span>&lt;T, TProperty&gt;&gt; propertyPicker)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">where</span> T : <span style="color: #2b91af">INotifyPropertyChanged</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: #2b91af">NotifyPropertyChanged</span>.CreateExpectation(owner,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyPicker, <span style="color: blue">false</span>);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">NotifyExpectation</span>&lt;T&gt;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CreateExpectation&lt;T, TProperty&gt;(T owner,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">Expression</span>&lt;<span style="color: #2b91af">Func</span>&lt;T, TProperty&gt;&gt; pickProperty,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">bool</span> eventExpected) <span style="color: blue">where</span> T : <span style="color: #2b91af">INotifyPropertyChanged</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> propertyName =</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ((<span style="color: #2b91af">MemberExpression</span>)pickProperty.Body).Member.Name;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">NotifyExpectation</span>&lt;T&gt;(owner,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyName, eventExpected);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">}</pre></div>
<p>And here's the NotifyExpectation class returned by both extension methods:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;\red163\green21\blue21;}??\fs20 \cf1 public\cf0  \cf1 class\cf0  \cf4 NotifyExpectation\cf0 &lt;T&gt;\par ??    \cf1 where\cf0  T : \cf4 INotifyPropertyChanged\par ??\cf0 \{\par ??    \cf1 private\cf0  \cf1 readonly\cf0  T owner;\par ??    \cf1 private\cf0  \cf1 readonly\cf0  \cf1 string\cf0  propertyName;\par ??    \cf1 private\cf0  \cf1 readonly\cf0  \cf1 bool\cf0  eventExpected;\par ??\par ??    \cf1 public\cf0  NotifyExpectation(T owner,\par ??        \cf1 string\cf0  propertyName, \cf1 bool\cf0  eventExpected)\par ??    \{\par ??        \cf1 this\cf0 .owner = owner;\par ??        \cf1 this\cf0 .propertyName = propertyName;\par ??        \cf1 this\cf0 .eventExpected = eventExpected;\par ??    \}\par ??\par ??    \cf1 public\cf0  \cf1 void\cf0  When(\cf4 Action\cf0 &lt;T&gt; action)\par ??    \{\par ??        \cf1 bool\cf0  eventWasRaised = \cf1 false\cf0 ;\par ??        \cf1 this\cf0 .owner.PropertyChanged += (sender, e) =&gt;\par ??        \{\par ??            \cf1 if\cf0  (e.PropertyName == \cf1 this\cf0 .propertyName)\par ??            \{\par ??                eventWasRaised = \cf1 true\cf0 ;\par ??            \}\par ??        \};\par ??        action(\cf1 this\cf0 .owner);\par ??\par ??        \cf4 Assert\cf0 .AreEqual&lt;\cf1 bool\cf0 &gt;(\cf1 this\cf0 .eventExpected,\par ??            eventWasRaised,\par ??            \cf5 "PropertyChanged on \{0\}"\cf0 , \cf1 this\cf0 .propertyName);\par ??    \}\par ??\}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">NotifyExpectation</span>&lt;T&gt;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">where</span> T : <span style="color: #2b91af">INotifyPropertyChanged</span></pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">readonly</span> T owner;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">readonly</span> <span style="color: blue">string</span> propertyName;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">readonly</span> <span style="color: blue">bool</span> eventExpected;</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> NotifyExpectation(T owner,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> propertyName, <span style="color: blue">bool</span> eventExpected)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.owner = owner;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.propertyName = propertyName;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.eventExpected = eventExpected;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> When(<span style="color: #2b91af">Action</span>&lt;T&gt; action)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">bool</span> eventWasRaised = <span style="color: blue">false</span>;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.owner.PropertyChanged += (sender, e) =&gt;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (e.PropertyName == <span style="color: blue">this</span>.propertyName)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eventWasRaised = <span style="color: blue">true</span>;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; action(<span style="color: blue">this</span>.owner);</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">Assert</span>.AreEqual&lt;<span style="color: blue">bool</span>&gt;(<span style="color: blue">this</span>.eventExpected,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eventWasRaised,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #a31515">"PropertyChanged on {0}"</span>, <span style="color: blue">this</span>.propertyName);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">}</pre></div>
<p>You can replace the Assertion with one that matches your test framework of choice (this one was written for MSTest).</p>
</div>
	
<div id="comments">
<hr>
<h2 id="comments-header">
	Comments
</h2>
	<div class="comment">
	<div class="comment-author">PeteB</div>
	<div class="comment-content">I'm never played with modifying/creating a fluent interface; how can this be extended to check for multiple NotifyProperty events (and NOT events)?<br>
<br>
e.g.<br>
    sut.ShouldNotifyOn(s =&gt; s.MyProperty).AndOn(s =&gt; s.MyDependentProperty).AndNotOn(s =&gt; s.MyIndependentProperty)<br>
        .When(s =&gt; s.MyProperty = &quot;Some new value&quot;);<br>
</div>
	<div class="comment-date">2012-08-06 11:39 UTC</div>
</div><div class="comment">
	<div class="comment-author"><a href="http://blog.ploeh.dk">Mark Seemann</a></div>
	<div class="comment-content">Would that add more value than three individual tests?</div>
	<div class="comment-date">2012-08-06 11:52 UTC</div>
</div>
</div>