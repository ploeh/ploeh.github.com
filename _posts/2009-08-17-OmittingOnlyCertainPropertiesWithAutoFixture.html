---
layout: post
tags: [AutoFixture]
date: 2009-08-17 19:33:40 UTC
title: "Omitting Only Certain Properties With AutoFixture"
comments: true
---
{% include JB/setup %}

<div id="post">
	<p>The default behavior of <a href="http://autofixture.codeplex.com/">AutoFixture</a> is to create an Anonymous Variable by assigning a value to all writable properties of the created instance. This is great in many scenarios, but not so much in others. You can <a href="http://blog.ploeh.dk/2009/07/23/DisablingAutoPropertiesInAutoFixture.aspx">disable this behavior by using the OmitAutoProperties method</a>, but sometimes, you <em>would</em> like most of the writable properties set, except one or two.</p> <p>Consider this simple Person class:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;}??\fs20 \cf1 public\cf0  \cf1 class\cf0  \cf4 Person\par ??\cf0 \{\par ??    \cf1 private\cf0  \cf4 Person\cf0  spouse;\par ??\par ??    \cf1 public\cf0  \cf4 DateTime\cf0  BirthDay \{ \cf1 get\cf0 ; \cf1 set\cf0 ; \}\par ??\par ??    \cf1 public\cf0  \cf1 string\cf0  Name \{ \cf1 get\cf0 ; \cf1 set\cf0 ; \}\par ??\par ??    \cf1 public\cf0  \cf4 Person\cf0  Spouse \par ??    \{\par ??        \cf1 get\cf0  \{ \cf1 return\cf0  \cf1 this\cf0 .spouse; \}\par ??        \cf1 set\par ??\cf0         \{\par ??            \cf1 this\cf0 .spouse = \cf1 value\cf0 ;\par ??            \cf1 if\cf0  (\cf1 value\cf0  != \cf1 null\cf0 )\par ??            \{\par ??                \cf1 value\cf0 .spouse = \cf1 this\cf0 ;\par ??            \}\par ??        \}\par ??    \}\par ??\}}
--> <div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Person</span></pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: #2b91af">Person</span> spouse;</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: #2b91af">DateTime</span> BirthDay { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">string</span> Name { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: #2b91af">Person</span> Spouse </pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { <span style="color: blue">return</span> <span style="color: blue">this</span>.spouse; }</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">set</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.spouse = <span style="color: blue">value</span>;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (<span style="color: blue">value</span> != <span style="color: blue">null</span>)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">value</span>.spouse = <span style="color: blue">this</span>;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">}</pre></div>
<p>The main trouble with this class, seen from AutoFixture's perspective, is the circular reference exposed by the Spouse property. When AutoFixture attempts to create an anonymous instance of Person, it will create anonymous values for all writable properties, and that includes the Spouse property, so it attempts to create a new instance of the Person class and assign values to all public properties, including the Spouse property, etc.</p>
<p>In other words, this line of code throws a StackOverflowException:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;}??\fs20 \cf1 var\cf0  person = fixture.CreateAnonymous&lt;\cf4 Person\cf0 &gt;();}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">var</span> person = fixture.CreateAnonymous&lt;<span style="color: #2b91af">Person</span>&gt;();</pre></div>
<p>If you would still like to have anonymous values assigned to Name and BirthDay, you can use the Without method:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;}??\fs20 \cf1 var\cf0  person = fixture.Build&lt;\cf4 Person\cf0 &gt;()\par ??    .Without(p =&gt; p.Spouse)\par ??    .CreateAnonymous();}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">var</span> person = fixture.Build&lt;<span style="color: #2b91af">Person</span>&gt;()</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; .Without(p =&gt; p.Spouse)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; .CreateAnonymous();</pre></div>
<p>This will give you an anonymous instance of the Person class, but with the Spouse property still with its default value of null.</p>
<p>Several calls to Without can be chained if you want to skip more than one property.</p>
</div>
	