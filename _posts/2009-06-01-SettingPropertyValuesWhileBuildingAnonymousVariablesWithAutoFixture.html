---
layout: post
tags: [AutoFixture]
date: 2009-06-01 12:35:18 UTC
title: "Setting Property Values While Building Anonymous Variables With AutoFixture"
comments: true
---
{% include JB/setup %}

<div id="post">
	<p>In my previous post I described <a href="http://blog.ploeh.dk/2009/05/26/TheAutoFixtureBuilder.aspx">how the Build method can be used to customize how a single anonymous variable is created</a>.</p> <p>A common customization is to set a property value during creation. In most cases, this can simply be done <em>after</em> the anonymous variable has been created (so the following is not an AutoFixture customization):</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;\red163\green21\blue21;}??\fs20 \cf1 var\cf0  mc = fixture.CreateAnonymous&lt;\cf4 MyClass\cf0 &gt;();\par ??mc.MyText = \cf5 "Ploeh"\cf0 ;}
--> <div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">var</span> mc = fixture.CreateAnonymous&lt;<span style="color: #2b91af">MyClass</span>&gt;();</pre><pre style="margin: 0px">mc.MyText = <span style="color: #a31515">"Ploeh"</span>;</pre></div>
<p>By default, <a href="http://autofixture.codeplex.com/">AutoFixture</a> assigns anonymous values to all writable properties, but since they are writable, you can always explicitly give them different values if you care.</p>
<p>However, there are situations when a property is writable, but can't take just any value of its type. Sometimes this is a sign that you should reconsider your API, as I've <a href="http://blog.ploeh.dk/2009/05/01/DealingWithConstrainedInput.aspx">previously described</a>, but it may also be a legitimate situation.</p>
<p>Consider a Filter class that has Min and Max properties. To be semantically correct, the Min property must be less than or equal to the Max property. Each property is implemented like this:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;\red163\green21\blue21;}??\fs20 \cf1 public\cf0  \cf1 int\cf0  Min\par ??\{\par ??    \cf1 get\cf0  \{ \cf1 return\cf0  \cf1 this\cf0 .min; \}\par ??    \cf1 set\par ??\cf0     \{\par ??        \cf1 if\cf0  (\cf1 value\cf0  &gt; \cf1 this\cf0 .Max)\par ??        \{\par ??            \cf1 throw\cf0  \cf1 new\cf0  \cf4 ArgumentOutOfRangeException\cf0 (\cf5 "value"\cf0 );\par ??        \}\par ??        \cf1 this\cf0 .min = \cf1 value\cf0 ;\par ??    \}\par ??\}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">int</span> Min</pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { <span style="color: blue">return</span> <span style="color: blue">this</span>.min; }</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">set</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (<span style="color: blue">value</span> &gt; <span style="color: blue">this</span>.Max)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">ArgumentOutOfRangeException</span>(<span style="color: #a31515">"value"</span>);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.min = <span style="color: blue">value</span>;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">}</pre></div>
<p>When you ask AutoFixture to create an instance of the Filter class, it will throw an exception because it's attempting to set the Min property after the Max property, and the <a href="http://blog.ploeh.dk/2009/04/03/CreatingNumbersWithAutoFixture.aspx">default algorithm for numbers</a> is to return numbers in an increasing sequence. (In this example, the Min property is being assigned a value <em>after</em> the Max property, but AutoFixture has no contract that states that the order in which properties are assigned is guaranteed.) In other words, this throws an exception:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;}??\fs20 \cf1 var\cf0  f = fixture.CreateAnonymous&lt;\cf4 Filter\cf0 &gt;();}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">var</span> f = fixture.CreateAnonymous&lt;<span style="color: #2b91af">Filter</span>&gt;();</pre></div>
<p>To solve this problem, we will have to customize the assignment of the Min and Max properties, <em>before</em> we ask AutoFixture to create an instance of the Filter class. Here's how to do that:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;}??\fs20 \cf1 int\cf0  min = fixture.CreateAnonymous&lt;\cf1 int\cf0 &gt;();\par ??\cf1 int\cf0  max = min + 1;\par ??\cf1 var\cf0  f = fixture.Build&lt;\cf4 Filter\cf0 &gt;()\par ??    .With(s =&gt; s.Max, max)\par ??    .With(s =&gt; s.Min, min)\par ??    .CreateAnonymous();}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">int</span> min = fixture.CreateAnonymous&lt;<span style="color: blue">int</span>&gt;();</pre><pre style="margin: 0px"><span style="color: blue">int</span> max = min + 1;</pre><pre style="margin: 0px"><span style="color: blue">var</span> f = fixture.Build&lt;<span style="color: #2b91af">Filter</span>&gt;()</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; .With(s =&gt; s.Max, max)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; .With(s =&gt; s.Min, min)</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; .CreateAnonymous();</pre></div>
<p>The With method lets you specify an expression that identifies a property, as well as the value that should be assigned to that property. When you do that, AutoFixture will never attempt to assign an anonymous value to that property, but will instead use the value you specified.</p>
<p>In most cases, just creating a truly anonymous instance and subsequently explicitly assigning any significant values is easier, but using the Build method with one or more calls to the With method gives you the power to override any property assignments before the instance is created.</p>
</div>
	