---
layout: post
tags: [AutoFixture, Unit Testing]
date: 2009-07-23 14:54:45 UTC
title: "Disabling AutoProperties In AutoFixture"
comments: true
---
{% include JB/setup %}

<div id="post">
	<p>Since <a href="http://autofixture.codeplex.com/">AutoFixture</a> <a href="http://blog.ploeh.dk/2009/07/01/AutoFixtureAsTestDataBuilder.aspx">is a Test Data Builder</a>, one of its most important tasks is to build up graphs of fully populated, yet semantically correct, strongly typed objects. As such, its default behavior is to assign a value to every writable property in the object graph.</p> <p>While this is sometimes the desired behavior, at other times it is not.</p> <p>This is particularly the case when you want to test that a newly created object has a property of a particular value. When you want to test the default value of a writable property, AutoFixture's AutoProperty feature is very much in the way.</p> <p>Let's consider as an example a piece of software that deals with vehicle registration. By default, a vehicle should have four wheels, since this is the most common occurrence. Although I always practice TDD, I'll start by showing you the Vehicle class to illustrate what I mean.</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;}??\fs20 \cf1 public\cf0  \cf1 class\cf0  \cf4 Vehicle\par ??\cf0 \{\par ??    \cf1 public\cf0  Vehicle()\par ??    \{\par ??        \cf1 this\cf0 .Wheels = 4;\par ??    \}\par ??\par ??    \cf1 public\cf0  \cf1 int\cf0  Wheels \{ \cf1 get\cf0 ; \cf1 set\cf0 ; \}\par ??\}}
--> <div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Vehicle</span></pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> Vehicle()</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.Wheels = 4;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px">&nbsp;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">int</span> Wheels { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</pre><pre style="margin: 0px">}</pre></div>
<p>Here's a test that ensures that the default number of wheels is <em>4</em>  -  or does it?</p>
<p>In fact the assertion fails because the actual value is <em>1</em>, not <em>4</em>.</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue0;\red255\green255\blue255;\red43\green145\blue175;\red0\green0\blue255;\red0\green128\blue0;\red163\green21\blue21;}??\fs20 [\cf3 TestMethod\cf0 ]\par ??\cf4 public\cf0  \cf4 void\cf0  AnonymousVehicleHasWheelsAssignedByFixture()\par ??\{\par ??    \cf5 // Fixture setup\par ??\cf0     \cf4 var\cf0  fixture = \cf4 new\cf0  \cf3 Fixture\cf0 ();\par ??    \cf4 var\cf0  sut = fixture.CreateAnonymous&lt;\cf3 Vehicle\cf0 &gt;();\par ??    \cf5 // Exercise system\par ??\cf0     \cf4 var\cf0  result = sut.Wheels;\par ??    \cf5 // Verify outcome\par ??\cf0     \cf3 Assert\cf0 .AreEqual&lt;\cf4 int\cf0 &gt;(4, result, \cf6 "Wheels"\cf0 );\par ??    \cf5 // Teardown\par ??\cf0 \}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px">[<span style="color: #2b91af">TestMethod</span>]</pre><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">void</span> AnonymousVehicleHasWheelsAssignedByFixture()</pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Fixture setup</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> fixture = <span style="color: blue">new</span> <span style="color: #2b91af">Fixture</span>();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> sut = fixture.CreateAnonymous&lt;<span style="color: #2b91af">Vehicle</span>&gt;();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Exercise system</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> result = sut.Wheels;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Verify outcome</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">Assert</span>.AreEqual&lt;<span style="color: blue">int</span>&gt;(4, result, <span style="color: #a31515">"Wheels"</span>);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Teardown</span></pre><pre style="margin: 0px">}</pre></div>
<p>Why does the test fail when the value of Wheels is set to <em>4</em> in the constructor? It fails because AutoFixture is designed to create <em>populated</em> test data, so it assigns a value to every writable property. Wheels is a writable property, so AutoFixture assigns an integer value to it using its <a href="http://blog.ploeh.dk/2009/04/03/CreatingNumbersWithAutoFixture.aspx">default algorithm for creating anonymous numbers</a>. Since no other numbers are being created during this test, the number assigned to Wheels is <em>1</em>. This is AutoFixture's AutoProperties feature in effect.</p>
<p>When you want to test constructor logic, or otherwise wish to disable the AutoProperties feature, you can use a <a href="http://blog.ploeh.dk/2009/05/26/TheAutoFixtureBuilder.aspx">customized Builder</a> with the OmitAutoProperties method:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue0;\red255\green255\blue255;\red43\green145\blue175;\red0\green0\blue255;\red0\green128\blue0;\red163\green21\blue21;}??\fs20 [\cf3 TestMethod\cf0 ]\par ??\cf4 public\cf0  \cf4 void\cf0  VehicleWithoutAutoPropertiesWillHaveFourWheels()\par ??\{\par ??    \cf5 // Fixture setup\par ??\cf0     \cf4 var\cf0  fixture = \cf4 new\cf0  \cf3 Fixture\cf0 ();\par ??    \cf4 var\cf0  sut = fixture.Build&lt;\cf3 Vehicle\cf0 &gt;()\par ??        .OmitAutoProperties()\par ??        .CreateAnonymous();\par ??    \cf5 // Exercise system\par ??\cf0     \cf4 var\cf0  result = sut.Wheels;\par ??    \cf5 // Verify outcome\par ??\cf0     \cf3 Assert\cf0 .AreEqual&lt;\cf4 int\cf0 &gt;(4, result, \cf6 "Wheels"\cf0 );\par ??    \cf5 // Teardown\par ??\cf0 \}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px">[<span style="color: #2b91af">TestMethod</span>]</pre><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">void</span> VehicleWithoutAutoPropertiesWillHaveFourWheels()</pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Fixture setup</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> fixture = <span style="color: blue">new</span> <span style="color: #2b91af">Fixture</span>();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> sut = fixture.Build&lt;<span style="color: #2b91af">Vehicle</span>&gt;()</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .OmitAutoProperties()</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CreateAnonymous();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Exercise system</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> result = sut.Wheels;</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Verify outcome</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">Assert</span>.AreEqual&lt;<span style="color: blue">int</span>&gt;(4, result, <span style="color: #a31515">"Wheels"</span>);</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Teardown</span></pre><pre style="margin: 0px">}</pre></div>
<p>The OmitAutoProperties method instructs AutoFixture to skip assigning automatic Anonymous Values to all writable properties in the object graph. Any properties specifically assigned by the <a href="http://blog.ploeh.dk/2009/06/01/SettingPropertyValuesWhileBuildingAnonymousVariablesWithAutoFixture.aspx">With method</a> will still be assigned.</p>
<p>The test using OmitAutoProperties succeeds.</p>
</div>
	