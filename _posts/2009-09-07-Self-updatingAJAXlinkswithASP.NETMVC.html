---
layout: post
tags: [ASP.NET MVC]
date: 2009-09-07 18:14:39 UTC
title: "Self-updating AJAX links with ASP.NET MVC"
---
{% include JB/setup %}

<div id="post">
	<p>How can you make an AJAX link that updates itself in ASP.NET MVC? My colleague Mikkel and I recently had that problem and we couldn't find any guidance on this topic, so now that we have a solution, I thought I'd share it.</p> <p>The problem is simple: We needed a link that invoked some server side code and updated the text of the link itself based on the result of the operation. Here is a simplified example:</p> <p><a href="http://blog.ploeh.dk/content/binary/WindowsLiveWriter/SelfupdatingAJAXlinkswithASP.NETMVC_791E/image_2.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://blog.ploeh.dk/content/binary/WindowsLiveWriter/SelfupdatingAJAXlinkswithASP.NETMVC_791E/image_thumb.png" width="267" height="75"></a> </p> <p>Each time you click the link, it should invoke a Controller Action and return a new number that should appear as the link text.</p> <p>This is pretty simple to implement once you know how. The first thing to realize is that the link and all the AJAX stuff must be placed in a user control. The only thing that needs to go into the containing page is the containing element itself:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red163\green21\blue21;\red0\green0\blue0;\red255\green0\blue0;\red255\green238\blue98;}??\fs20 \cf1 &lt;\cf3 h2\cf1 &gt;\cf0 Self-updating AJAX link\cf1 &lt;/\cf3 h2\cf1 &gt;\par ??\cf0 Click the link to update the number:\par ??\cf1 &lt;\cf3 span\cf0  \cf5 id\cf1 ="thespan"&gt;\par ??\cf0     \cb6\highlight6 &lt;%\cb0\highlight0  \cf1 this\cf0 .Html.RenderPartial(\cf3 "NumberAjaxUserControl"\cf0 ); \cb6\highlight6 %&gt;\par ??\cf1\cb0\highlight0 &lt;/\cf3 span\cf1 &gt;}
--> <div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">h2</span><span style="color: blue">&gt;</span>Self-updating AJAX link<span style="color: blue">&lt;/</span><span style="color: #a31515">h2</span><span style="color: blue">&gt;</span></pre><pre style="margin: 0px">Click the link to update the number:</pre><pre style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">span</span> <span style="color: red">id</span><span style="color: blue">="thespan"&gt;</span></pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="background: #ffee62">&lt;%</span> <span style="color: blue">this</span>.Html.RenderPartial(<span style="color: #a31515">"NumberAjaxUserControl"</span>); <span style="background: #ffee62">%&gt;</span></pre><pre style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">span</span><span style="color: blue">&gt;</span></pre></div>
<p>Notice the <em>id</em> of the span element  -  this same <em>id</em> will be referenced from the user control.</p>
<p>To bootstrap this view, the Controller Action for the page contains code that assigns an initial value to the number (in this case <em>1</em>):</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;\red163\green21\blue21;}??\fs20 \cf1 public\cf0  \cf4 ActionResult\cf0  Index()\par ??\{\par ??    \cf1 this\cf0 .ViewData[\cf5 "number"\cf0 ] = 1.ToString();\par ??    \cf1 return\cf0  \cf1 this\cf0 .View();\par ??\}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: #2b91af">ActionResult</span> Index()</pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.ViewData[<span style="color: #a31515">"number"</span>] = 1.ToString();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">this</span>.View();</pre><pre style="margin: 0px">}</pre></div>
<p>To keep the example simple, I simply add the number to the ViewData dictionary, but in any production implementation, I would opt to use a strongly typed ViewModel instead.</p>
<p>The NumberAjaxUserControl itself only contains the definition of the AJAX link:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue0;\red255\green238\blue98;\red0\green0\blue255;\red255\green255\blue255;\red163\green21\blue21;\red255\green0\blue0;\red43\green145\blue175;}??\fs20 \cb2\highlight2 &lt;%\cf3\cb0\highlight0 @\cf0  \cf5 Control\cf0  \cf6 Language\cf3 ="C#"\cf0  \cf6 Inherits\cf3 ="System.Web.Mvc.ViewUserControl"\cf0  \cb2\highlight2 %&gt;\par ??&lt;%\cf3\cb0\highlight0 @\cf0  \cf5 Import\cf0  \cf6 Namespace\cf3 ="System.Web.Mvc.Ajax"\cf0  \cb2\highlight2 %&gt;\par ??&lt;%\cf3\cb0\highlight0 =\cf0  \cf3 this\cf0 .Ajax.ActionLink((\cf3 string\cf0 )\cf3 this\cf0 .ViewData[\cf5 "number"\cf0 ],\par ??    \cf5 "GetNext"\cf0 ,\par ??    \cf3 new\cf0  \{ number = \cf3 this\cf0 .ViewData[\cf5 "number"\cf0 ] \}, \par ??    \cf3 new\cf0  \cf7 AjaxOptions\cf0  \{ UpdateTargetId = \cf5 "thespan"\cf0  \})\cb2\highlight2 %&gt;}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="background: #ffee62">&lt;%</span><span style="color: blue">@</span> <span style="color: #a31515">Control</span> <span style="color: red">Language</span><span style="color: blue">="C#"</span> <span style="color: red">Inherits</span><span style="color: blue">="System.Web.Mvc.ViewUserControl"</span> <span style="background: #ffee62">%&gt;</span></pre><pre style="margin: 0px"><span style="background: #ffee62">&lt;%</span><span style="color: blue">@</span> <span style="color: #a31515">Import</span> <span style="color: red">Namespace</span><span style="color: blue">="System.Web.Mvc.Ajax"</span> <span style="background: #ffee62">%&gt;</span></pre><pre style="margin: 0px"><span style="background: #ffee62">&lt;%</span><span style="color: blue">=</span> <span style="color: blue">this</span>.Ajax.ActionLink((<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewData[<span style="color: #a31515">"number"</span>],</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: #a31515">"GetNext"</span>,</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">new</span> { number = <span style="color: blue">this</span>.ViewData[<span style="color: #a31515">"number"</span>] }, </pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">new</span> <span style="color: #2b91af">AjaxOptions</span> { UpdateTargetId = <span style="color: #a31515">"thespan"</span> })<span style="background: #ffee62">%&gt;</span></pre></div>
<p>The first parameter to the ActionLink method is simply the current number to render as the link text. Since I'm using the untyped ViewData dictionary for this example, I need to cast it to a string.</p>
<p>The next parameter ("GetNext") indicates the Controller Action to invoke when the link is clicked  -  I will cover that shortly.</p>
<p>The third parameter is a Route Value that specifies that the parameter <em>number</em> with the correct value will be supplied to the GetNext Controller Action. It uses the number stored in ViewData.</p>
<p>The last parameter indicates the <em>id</em> of the element to update. Recall from before that this name was "thespan".</p>
<p>The only missing piece now is the GetNext Controller Action:</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;\red163\green21\blue21;}??\fs20 \cf1 public\cf0  \cf4 PartialViewResult\cf0  GetNext(\cf1 int\cf0  number)\par ??\{\par ??    \cf1 this\cf0 .ViewData[\cf5 "number"\cf0 ] = (number + 1).ToString();\par ??    \cf1 return\cf0  \cf1 this\cf0 .PartialView(\cf5 "NumberAjaxUserControl"\cf0 );\par ??\}}
-->
<div style="font-family: courier new; background: white; color: black; font-size: 10pt"><pre style="margin: 0px"><span style="color: blue">public</span> <span style="color: #2b91af">PartialViewResult</span> GetNext(<span style="color: blue">int</span> number)</pre><pre style="margin: 0px">{</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.ViewData[<span style="color: #a31515">"number"</span>] = (number + 1).ToString();</pre><pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">this</span>.PartialView(<span style="color: #a31515">"NumberAjaxUserControl"</span>);</pre><pre style="margin: 0px">}</pre></div>
<p>In this example I simply chose to increment the number by one, but I'm sure you can imagine that this method could just as well perform a database lookup or something similar.</p>
<p>Notice that the method returns a PartialViewResult that uses the same user control that I used to bootstrap the <em>thespan</em> element. This means that every time the link is clicked, the GetNext method is updated, and the exact same user control is used to render the content that dynamically replaces the original content of the element.</p>
</div>
	
<hr>
<div id="comments">
<h2 id="comments-header">
	Comments
</h2>
	<div class="comment">
	<div class="comment-author">anonymous</div>
	<div class="comment-content">I kind of prefer the jQuery approach, it is much less intrusive: you render your link as usual and then you use the &quot;live&quot; function:<br>
<br>
$(&quot;a#some_link&quot;).live('click', function(){ $('#thespan').load(this.href); });<br>
<br>
This will automatically watch for DOM updates of the anchor tag and if it detects any it will automatically rebind the click function.</div>
	<div class="comment-date">2009-09-08 07:00 UTC</div>
</div><div class="comment">
	<div class="comment-author"><a href="http://blog.ploeh.dk">Mark Seemann</a></div>
	<div class="comment-content">Thank you for your comment<br>
<br>
It looks pretty simple. The following questions are entirely based on my total (and very deplorable) lack of JQuery knowledge:<br>
<br>
Will this allow me to query the server with particular parameter values (the <i>number</i> parameter in my example)?<br>
Will it allow me to update the link with the result from the server?<br>
<br>
From your snippet, I can't really see where it is specified which URL is requested, what are the query parameters, how the returned result is used to update the link text, etc.</div>
	<div class="comment-date">2009-09-08 08:16 UTC</div>
</div>
</div>